# DR-003: 説明欄を展開してから全文を取得する

- **日付**: 2026-02-28
- **ステータス**: 採用

## 背景

動画の説明文が一部しか取得できていないことが判明した。取得されるテキストは、説明欄が折りたたまれた状態で表示される冒頭部分のみだった。

## 原因

2つの問題が重なっていた:

1. **展開していなかった** — 説明欄が折りたたまれた状態でテキストを取得していた
2. **セレクタが間違っていた** — 展開ボタンのクリックを追加した後も、参照先のセレクタが展開前のテキスト用だった

YouTubeの説明欄のDOM構造:

| セレクタ | 内容 |
|---------|------|
| `#attributed-snippet-text` | 展開**前**の短縮テキスト（冒頭のみ） |
| `#expanded yt-attributed-string` | 展開**後**の全文 |

## 修正

1. 展開ボタン（`#expand`）をクリックし、500ms待機
2. 展開後の全文が格納される `#expanded yt-attributed-string` を優先的に参照
3. フォールバックとして旧セレクタ `#attributed-snippet-text` も残す

副次的な効果として、説明欄が展開されることで「文字起こしを表示」ボタンも露出するため、字幕パネルのオープン処理も安定する。

## 変更ファイル

- `extension/background.js` — `injectedGetTranscriptInfo()` のメタデータ収集部分
